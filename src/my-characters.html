<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />

    <title>LoAM - 내 캐릭터</title>

    <!-- Global Style and Script -->
    <link rel="stylesheet" href="./globalStyle.css" />
    <script type="module" src="./globalScript.js"></script>

    <!-- Page Style and Script -->
    <link rel="stylesheet" href="./css/my-characters.css" />

  </head>
  <body>
    <div id="includedHeaderWrapper"><!-- include by layout.js --></div>

    <div id="pageContentWrapper">
      <div id="myCharactersPage">
        <div class="page-title">
          내 캐릭터
        </div>

        <section class="card-section">
          <div class="card-section-title">
            내 캐릭터 추가
          </div>
          <div class="add-character-form">
            <input
              type="text"
              placeholder="닉네임 입력"
              class="input"
              id="characterNicknameInput"
              spellcheck="false"
            />
            <button
              type="button"
              class="button"
              id="addCharacterButton"
            >
              추가
            </button>
          </div>
        </section>

        <section class="card-section">
          <div class="card-section-title">
            내 캐릭터 목록 <span class="character-count">0</span>
          </div>
          <div class="character-list">
            <a class="character-item">
              <div class="character-profile-image-box">
                
              </div>
              <div class="character-info-panel">
                <div class="character-nickname-panel">
                  <div class="character-nickname">
                    닉네임
                  </div>
                  <div class="character-level">
                    템렙
                  </div>
                </div>
                <div class="character-class">
                  직업
                </div>
              </div>
              <div class="character-action-panel">
                삭제
              </div>
            </a>
            <a class="character-item">
              <div class="character-profile-image-box">
                
              </div>
              <div class="character-info-panel">
                <div class="character-nickname-panel">
                  <div class="character-nickname">
                    닉네임
                  </div>
                  <div class="character-level">
                    템렙
                  </div>
                </div>
                <div class="character-class">
                  직업
                </div>
              </div>
              <div class="character-action-panel">
                삭제
              </div>
            </a>
          </div>
        </section>

        <div id="loading"></div>
      </div>
    </div>

    <div id="includedFooterWrapper"><!-- include by layout.js --></div>

    <!-- Page Script -->
    <script type="module">
      import { api, snackbar, utils, data } from './lib/stdlib.js';

      // 사용할 로딩 엘리먼트 추가
      const $loading = document.getElementById('loading');
      utils.addLoadingElement($loading, 'fixed');

      const $characterNicknameInput = document.getElementById('characterNicknameInput');
      const $addCharacterButton = document.getElementById('addCharacterButton');

      $characterNicknameInput.addEventListener('keyup', (e) => {
        if (e.key === 'Enter') {
          submitCharacterNickname();
        }
      });

      $addCharacterButton.addEventListener('click', () => {
        submitCharacterNickname();
      });

      async function submitCharacterNickname() {
        const nickname = $characterNicknameInput.value.trim();
        if (nickname.length === 0) return;

        // TODO 기존에 있는 캐릭터는 추가하지 않기
        const testAlready = false;
        if (testAlready === true) {
          snackbar.error('이미 추가된 캐릭터입니다.');
          return
        }

        utils.showElement($loading);

        try {
          const chracterInfo = await api.getCharacterInfoByNickname(nickname);
          if (chracterInfo === null) {
            snackbar.error('캐릭터가 없습니다. 닉네임을 확인해 주세요.');
            return;
          }

          $characterNicknameInput.value = '';


          // 필요한 정보만 가져오기
          // 내부 data storage에 저장
          console.log('chracterInfo', chracterInfo);



        } catch (error) {
          console.error('submitCharacterNickname', error);
          snackbar.error('캐릭터 추가에 실패하였습니다.');

        } finally {
          utils.hideElement($loading);
        }
      }

    </script>

  </body>
</html>