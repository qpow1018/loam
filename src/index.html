<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />

    <title>LoAM</title>

    <!-- Global Style and Script -->
    <link rel="stylesheet" href="./globalStyle.css" />
    <script type="module" src="./globalScript.js"></script>

    <!-- Page Style and Script -->
    <link rel="stylesheet" href="./css/loado.css" />

  </head>
  <body>
    <div id="includedHeaderWrapper"><!-- include by layout.js --></div>

    <main id="pageContentWrapper">
      <div class="loado-page-container">
        <div class="loado-page-main-area">
          <section class="card-section">
            <div class="card-section-title-panel">
              <div class="card-section-title">
                메인 캐릭터
              </div>
              <button
                id="openMainCharacterModalButton"
                class="button add-loado-button"
                type="button"
              >
                설정
              </button>
            </div>

            <div id="mainCharacterTable">
              <div class="table-subject-column">
                <div class="loado-cell">빈칸</div>
                
                <div class="loado-cell">메모</div>
                <div class="loado-cell">혈석</div>
                <div class="loado-cell">에포나</div>
                <div class="loado-cell">호감도</div>
                <div class="loado-cell">카던</div>
                <div class="loado-cell">가토</div>

                <div class="loado-cell">주간에포나</div>
                <div class="loado-cell">혈석교환</div>
                <div class="loado-cell">큐브</div>
                <div class="loado-cell">엔드컨텐츠1</div>
                <div class="loado-cell">엔드컨텐츠2</div>
                <div class="loado-cell">엔드컨텐츠3</div>
              </div>
              <div class="table-body">
                <div class="table-character-column">
                  <div class="loado-cell">닉네임</div>
                  
                  <div class="loado-cell">메모</div>
                  <div class="loado-cell">혈석</div>
                  <div class="loado-cell">에포나</div>
                  <div class="loado-cell">호감도</div>
                  <div class="loado-cell">카던</div>
                  <div class="loado-cell">가토</div>

                  <div class="loado-cell">주간에포나</div>
                  <div class="loado-cell">혈석교환</div>
                  <div class="loado-cell">큐브</div>
                  <div class="loado-cell">엔드컨텐츠1</div>
                  <div class="loado-cell">엔드컨텐츠2</div>
                  <div class="loado-cell">엔드컨텐츠3</div>
                </div>

                <div class="table-character-column">
                  <div class="loado-cell">닉네임</div>
                  
                  <div class="loado-cell">메모</div>
                  <div class="loado-cell">혈석</div>
                  <div class="loado-cell">에포나</div>
                  <div class="loado-cell">호감도</div>
                  <div class="loado-cell">카던</div>
                  <div class="loado-cell">가토</div>

                  <div class="loado-cell">주간에포나</div>
                  <div class="loado-cell">혈석교환</div>
                  <div class="loado-cell">큐브</div>
                  <div class="loado-cell">엔드컨텐츠1</div>
                  <div class="loado-cell">엔드컨텐츠2</div>
                  <div class="loado-cell">엔드컨텐츠3</div>
                </div>
              </div>
            </div>
          </section>

          <section class="card-section">
            <div class="card-section-title-panel">
              <div class="card-section-title">
                원정대
              </div>
              <button
                id="openLoadoTeamButton"
                class="button add-loado-button"
                type="button"
              >
                추가
              </button>
            </div>

            생기<br/>
            영지관리<br/>
            이벤트?<br/>
            
            카게<br/>
            유령선<br/>
            필보<br/>
            모코콩<br/>
            배틀아레나<br/>
            
            징표교환<br/>
            카드팩교환<br/>
            시련의빛<br/>
            도비스<br/>
            도가토<br/>
            카게지도<br/>
          </section>
        </div>

        <div class="loado-page-sub-area">
          <section class="card-section">
            <div class="card-section-title-panel">
              서브 캐릭터 / 추가
            </div>
            혈석<br/>
            에포나<br/>
            주포나<br/>
            혈석교환<br/>
            큐브<br/>
          </section>
        </div>

        <div class="loado-page-memo-area">
          <section class="card-section">
            <div class="card-section-title-panel">
              메모 / 추가
            </div>
          </section>
        </div>
      </div>

      <section
        id="mainCharacterModal"
        class="loam-modal"
      >
        <div class="modal-title-panel">
          <div class="modal-title">메인 캐릭터 설정</div>
          <button class="modal-close-button">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="modal-content">
          <div class="modal-section">
            <div class="modal-section-title">
              컨텐츠 관리
            </div>
            <div class="switch-cell-container" id="mainCharacterLoadoList"></div>
          </div>
          <div class="modal-section">
            <div class="modal-section-title">
              캐릭터 관리
            </div>
            <div class="switch-cell-container">
              캐릭터 목록 / 체크박스
            </div>
          </div>
        </div>
      </section>

      <!-- <section
        id="loadoTeamModal"
        class="loam-modal"
      >
        <div class="modal-title-panel">
          <div class="modal-title">원정대 할 일 추가</div>
          <button class="modal-close-button">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      
        <div class="modal-content">
          addMainCharacterLoadoModal 모달 테스트<br/>
        </div>
      </section> -->
    </main>

    <div id="includedFooterWrapper"><!-- include by layout.js --></div>

    <script type="module">
      import config from './config/index.js';
      import { api, snackbar, modal, utils, data } from './lib/stdlib.js';
      import Drag from './modules/drag.js';

      const $openMainCharacterModalButton = document.querySelector('#openMainCharacterModalButton');
      const $closeMainCharacterModalButton = document.querySelector('#mainCharacterModal .modal-close-button');

      // 메인 캐릭터 테이블
      $openMainCharacterModalButton.addEventListener('click', () => modal.openWithId('mainCharacterModal'));
      $closeMainCharacterModalButton.addEventListener('click', () => modal.closeWithId('mainCharacterModal'));

      setupMainCharacterModalContent();

      function setupMainCharacterModalContent() {
        const $mainCharacterLoadoList = document.querySelector('#mainCharacterLoadoList');
        const _allLoadoInMainCharacter = data.getAllLoadoInMainCharacter();
        _allLoadoInMainCharacter.forEach(item => {
          const $elm = getMainCharacterModalContentElm(item.isUse, item.keyName);
          $elm.addEventListener('click', () => handleClickMainCharacterModalContent(item.isUse, item.keyName, $elm));
          $mainCharacterLoadoList.append($elm);
        });

        

      }

      function getMainCharacterModalContentElm(isUse, keyName) {
        const $elm = document.createElement('div');
        $elm.classList.add('switch-cell');
        if (isUse === false) $elm.classList.add('switch-cell-not-use');

        $elm.insertAdjacentHTML(
          'afterbegin',
          `
            <div class="switch-cell-chip">
              <span class="switch-cell-chip-use-text">사용</span>
              <span class="switch-cell-chip-not-use-text">미사용</span>
            </div>
            <div class="switch-cell-label">
              ${ config.data[keyName].title }
            </div>
          `
        );
        return $elm;
      }

      function handleClickMainCharacterModalContent(isUse, keyName, $elm) {
        const _allLoadoInMainCharacter = data.getAllLoadoInMainCharacter();
        const targetIndex = _allLoadoInMainCharacter.findIndex(item => item.keyName === keyName);

        if ($elm.classList.contains('switch-cell-not-use') === true) {
          $elm.classList.remove('switch-cell-not-use');
          _allLoadoInMainCharacter[targetIndex].isUse = true;
        } else {
          $elm.classList.add('switch-cell-not-use');
          _allLoadoInMainCharacter[targetIndex].isUse = false;
        }

        data.setAllLoadoInMainCharacter(_allLoadoInMainCharacter);
      }

      // TEMP TODO
      modal.openWithId('mainCharacterModal');



      // 원정대 할 일 추가 모달
      // const openLoadoTeamButton = document.getElementById('openLoadoTeamButton');
      // const closeLoadoTeamButton = document.querySelector('#loadoTeamModal .modal-close-button');
      // openLoadoTeamButton.addEventListener('click', () => {
      //   modal.openWithId('loadoTeamModal');
      // });
      // closeLoadoTeamButton.addEventListener('click', () => {
      //   modal.closeWithId('loadoTeamModal');
      // });
      
      
    </script>
  </body>
</html>